README for Tea/3.9.x

Copyright (C) 1997-2011 TeaTrove.org

The Tea template language is designed to be used by a hosting system, and
so it only delivers exports that can be imported into another product. Tea
isn't a stand-alone system. Most of the code in the Tea product supports the
compiler. A much smaller amount of code supports Tea in a runtime environment.


Change History


4.0.0 to 4.1.0
=============================
- Added null-safe operator (ie: user?.address?.city)
- Added ternary operator (ie: count % 2 == 0 ? 'even' : 'odd')
- Added elvis ternary operator (ie: value = value ?: 5)
- Added truthful statements for logic/if statements (collections, arrays, strings, objects, numbers, etc)
- Added spaceship operator for comparisons and sorting (ie: num1 <=> num2)
- Added spread operator to retrieve properties on collections (ie: allUserNames = users*.fullName)
- Added direct function invocation (ie: obj.doSomething())
- Added static function invocation (ie: Math.abs(num))
- Added variable argument support (ie: doSomething(a, b, c) via void doSomething(String... args))
- Added JSON-like map notation (ie: ##(key : value, key : value))


3.9.0 to 4.0.0
=============================
- Added generics support to class files
- Added generics awareness to tea files (looping, definitions, etc)
- Added automatic imports configuraiton to automatically import packages without explicit defintion


3.5.1 to 3.9.0
===============================
- Added getTemplateInfos to TemplateRepository
- Added sort methods to UtilityContext and DefaultContext
- Changed packaging from com.go to org.teatrove
- Changed license from The Tea Software License 1.1 to Apache License 2.0
- Changed copyright from Walt Disney Internet Group to TeaTrove.org


3.5.0 to 3.5.1
===============================
- Resolve issue #DPTS-29 - add the ability to call out of tea to other view technologies like JSP 
- Resolve issue #TEA-39 - Remove overly verbose logging added in DPTS-17


3.4.4 to 3.5.0
===============================
- Building Tea for target platfrom java 1.6.
- Resolve issue #TEA-31. Implement the ability to annotate bean 'getter' methods that return collections with their contained element type.



3.4.3 to 3.4.4
===============================
- Resolve issue #TEA-35. Ability to do partial re-compiles.
- Resolve issue #TEA-36. All templates recompiling when a Windows template 
  server is referenced from Linux.
 


3.4.2 to 3.4.3
===============================
- Resolve issue #TEA-29.  Error when calling pre-compiled templates from
  compiled templates.
- Resolve issue #TEA-34.  Added new instrumentions to generated bytecode
  for the measurement of substitution block execution times.



3.4.1 to 3.4.2
===============================
- Resolve issue #TEA-28.  Tea compile time backslide with 3.4.1.



3.4.0 to 3.4.1
===============================
- Verified that Tea compiles cleanly on JDK 1.6.
- Resolved Jira issue #TEA-23.  Add compile time error when class names 
  exist in multiple imported packages.
- Resolved Jira issue #TEA-18.  Allow the 'as' keyword to be utilized to 
  type foreach array iterator variables.  Type casts can be either 
  narrowing or widening
- Resolved Jira issue #TEA-22.  Allow Perl like '=>' delimiter syntax when
  declaring associative arrays (in addition to ',').
- Resolved Jira issue #TEA-21.  Fix type unknown error when assigning 
  statically typed arrays.
- "Re-fixed" Jira issue #TEA-8.  This locale fix was undone by the Joda
  upgrade.



3.3.11 to 3.4.0
===============================
- Resolved Jira issue #TEA-6.  Added in-line production profiling of Tea
  templates.   Requires Trove 1.6.0 and TeaServlet 1.7.0.
- Resolved Jira issue #TEA-9.  Added 'continue' reserved word to foreach
  syntax.
- Resolved Jira issue #TEA-13.  Allow 'as' reserved word to be used in
  foreach syntax.  This implements the typing of collection iterators.
- Resolved Jira issue #TEA-14.  'Map' collections can now be iterated.
  This includes 'reverse'.  The iterator variable is the map key that
  can be used to dereference the value.  Associative arrays are now
  backed by a LinkedHashMap instead of a HashMap to preserve insertion
  ordering.  Also, 'Set' types can be iterated in reverse.



3.3.10 to 3.3.11
===============================
- Updated DefaultContext class to use new version of Joda (1.4).


3.3.9 to 3.3.10
===============================
- Resolved issue #TEA-8.  Change to dateFormat() was not recognizing locale
  settings.


3.3.8 to 3.3.9
===============================
- Resolved Issue #TEA-2. The dependency checking code is using '/' file path 
  delimiters while the high level Compile interface is expecting '.' path 
  separators. While this was working for the FileCompiler, it will not work 
  when using RemoteCompiler (via a template server). The change involves 
  replacing '/' with '.' in the TemplateRepository class. 
- Resolved Issues #TEA-3, TEA-4, TEA-5, TEA-6, and TEA-7.  Added ability to 
  make declarative typing 'static' such that any assignments that violate type 
  safety will result in a compile-time error.  Primitive types are also supported.


3.3.7 to 3.3.8
===============================
- Added new keywords 'define', 'as', and 'import'.  These all revolve around adding 
  declarative typing to the Tea language.
- Modified the DefaultContext to use SimpleDateFormat instead of the Joda date formatting
  class.  This resolves an issue introduced when upgrading to JDK 1.5, without 
  compromising support for earlier JDKs.


3.3.6 to 3.3.7
===============================
- Changed template naming exception message when a calling/called template name is mismatched.
  It now prompts the developer to check case sensitivity.
- Imported Trove 1.5.3 see the Trove release notes for further detail

3.3.5 to 3.3.6
===============================
- Fix bug #4400.  Was getting a ZipException if a jar filename in the classpath
  was not valid.
- Fix bug #4489.  Compiler incorrectly identifying a template as pre-compiled
  in the scenario where a callee template was deleted/renamed.


3.3.3 to 3.3.4
===============================
- Minor change to AbstractFileCompiler class to improve template compile speed.

3.3.2 to 3.3.3
===============================
- Minor change to TemplateRepository class to work around a bug in JDK 1.4.2_05

3.3.1 to 3.3.2
===============================
- Fixed bug with TemplateCallExctractor.  Throwing an NPE when an overloaded
  Tea app method with no params is overloaded with a different signatature.

3.3.0 to 3.3.1
===============================
- Added support for method/function call hierarchies to the template repository.
- Precompiled templates are extracted from all jar files in the system classpath 
  when the repository file is generated.

3.2.11 to 3.3.0
===============================
- Added the TeaLog which simplifies stack traces from Tea templates so they are
  easier for template authors to understand.  It strips off irrelevant stack 
  trace elements in the stack trace leaving only the relevant elements
  remaining.
- TemplateRepository will not be initialized (and safely ignored) when Tea is
  hosted outside of TeaServlet (i.e. Kettle, GoPublish).

3.2.10 to 3.2.11
===============================
- Added a template dependency checking repository.  If a template signature
  changes, any calling template must be recompiled.  This upstream dependency
  checking complements the existing downstream checks.  There are no additional
  configuration steps to use this feature.
- All native peer wrapper type conversions are generalized.  This will result
  in slightly reduced class file size and execution times for some applications.
- Import lastest (0.95) version of the joda time library


3.2.9 to 3.2.10
===============================
- Added a feature to allow for invocation of pre-compiled templates from other 
  templates be they dynamic or pre-compiled.   A pre-compiled template may in 
  turn nest calls to other templates as long as they are compiled against the 
  same common merged interface.   A new class named CompiledTemplate that subclasses 
  CompilationUnit has been added.
- Fixed a stack depth problem relating to conversion of peer wrapper types to 
  java.lang.Integer.

3.2.8 to 3.2.9
===============================
- Updated Joda datetime classes to 0.9 release.
- Fix for rare bug that occurs when all substitution blocks get optimized away
  due to dead code elimination.

3.2.7 to 3.2.8
===============================
- Improved compiler error message when template name doesn't match file name.
- Fixed bug in Tea compiler which would produce verify errors on maps of maps
  of constants.
- Once again, fixed an annoying bug that has been fixed before. The last file
  reporting an error would not be promptly closed.

3.2.6 to 3.2.7
===============================
- Fixed formatting of two digit years. It was showing upper two digits instead
  of lower two digits.

3.2.5 to 3.2.6
===============================
- Fixed method matching bug in Type class. It gave equal preference for
  converting int[]->String[] and int[]->String. Converting to a String[] is
  preferred.

3.2.4 to 3.2.5
===============================
- Fixed CompilationUnit casting bug in
  TemplateSourceImpl.ErrorRetriever.compileError().
- Updated Joda datetime classes to post 0.8 release.
- More Joda datetime support in Context classes. Added currentDateTime method;
  added print and toString methods that accept ReadableInstant.

3.2.3 to 3.2.4
===============================
- TemplateComplationResult now has a setAlreadyReloading() method.
- TemplateError now implements Serializable so they can be sent between 
  multiple machines.
- Fixed to synchronization issues related to template compilation. The 
  TemplateSourceImpl will only allow one compilation at a time.
- Added getTemplateLoader() to the TemplateSource interface and implementation.
- Fixed bug in generating break statement. Foreach loop finalizers were not
  being executed, and variables declared outside the loop were not always
  updated for use after the loop.
- Uses new DecimalFormat class from Trove for printing decimal numbers.
  Java's built-in decimal formatter follows a round-half-even rule, which is
  unintuitive.
- JavaClassGenerator now calls IntegerFactory class for boxing ints.
- Enabled ConcatenationReducer in TypeChecker.
- Added Joda time classes into product for faster date/time formatting.
  http://www.joda.org/
- Added more template compilation error information in TemplateError.
- Modified getTemplateErrors() interface in TemplateErrorListener to
  return a map where the key is the template name and the value is a list of
  TemplateError objects for that template.
- Added new interfaces in Template to return template source file and the
  time the source file is last modified.
- Added a new compileTemplates() interface in TemplateSource such that a
  boolean indicates if compilation should be recursive.
- Modified TemplateSourceImpl for updated TemplateError code, to find
  source file information for compiled templates, and provide interface to
  get source file information from the template object.
- Modified TemplateCompilateResults to use a map for template compilation
  errors such that the key is the template name and the value is a list of
  TemplateError objects for that template. Added more interfaces for the
  modified data type. Also added getAllTemplateErrors() method to return a
  list of all template errors.

3.2.2 to 3.2.3
===============================
- Moved the TemplateAdapter to the engine package so precompiled templates 
  would work properly. TemplateSource implementations should use this class 
  to instead of creating TemplateLoaders directly.

3.2.1 to 3.2.2
===============================
- Fixed a bug in the TypeChecker. In "if (a == null and ...) {} else {}", the
  else scope would treat variable "a" as always being non-null.
- Added the org.teatrove.tea.engine package to simplify the process of integrating 
  tea into other applications.
- Shared associative array instances are now created as unmodifiable. Although
  templates couldn't directly modify it, rogue Java functions could.

3.2.0 to 3.2.1
===============================
- Re-fixed a fix that from version 2.1.10: "Compiling large sets of templates
  would sometimes cause the VM to run out of memory."  The fix was to free up
  unused parsetrees during bulk compiles. This fix got undone in version 3.1.4,
  when the "preserveParseTree" method was added. If this method never got
  called, then all parse trees would be preserved, wasting memory.

3.1.5 to 3.2.0
===============================
- Fixed problem that allowed for infinite loops. Now The loop variable 
  cannot be modified or reused within that loop.
- Added new language keyword: 'break', which allows for breaking out of 
  foreach loops.
- Improved performance of date formatting and printing of unformatted integers.

3.1.4 to 3.1.5
===============================
- Added status reporting to Compiler. Allows a user interface tool to add a
  status listener to the Compiler that will be notified of compilation 
  progress.
- The Compiler now checks if the thread that it is running in has been 
  interrupted. If it has, then it returns the names of all the templates it 
  finished compiling. The Compiler only checks between files, so interrupting 
  within a file is not possible.
- Bug fix involving detached substitutions when passing its own substitutions.
- Added format accessor methods to Context.

3.1.3 to 3.1.4
===============================
- Fixed bug that would sometimes not apply a cast operation for the "isa"
  operator. This would cause a verify error when the template class was loaded.
- Added new constructor and new method to Compiler class so that template
  signatures can be saved and shared among Compiler instances. This is useful
  for development environments, like Kettle, offering performance improvements.

3.1.2 to 3.1.3
===============================
- Inner classes may be specified as template parameters and as argument for
  "isa" operator.
- Scanner has mode for emitting comments and other special tokens.
- The numberFormat function now accepts two additional arguments for setting
  infinity and NaN.
- Fixed a NullPointerException bug during type checking.
- Fixed exception guardian defect involving paren expressions.
- Fixed flaw in unicode escape processing.
- Number scanning in compiler is more to spec.
- Fixed NullPointerException when converting between number objects.
- Source file name listed in error messages and stack traces now includes
  directory components, relative to the root source directory.
- Performance enhancement for string concatenation involving two arguments.
- Deprecated io package since those classes moved to Trove.

3.1.1 to 3.1.2
===============================
- Exception guardian properly traverses into substitution blocks.
- Calling foreach on a null array or collection now skips past the loop without
  a NullPointerException being thrown.

3.1.0 to 3.1.1
===============================
- Added getTemplateLoader method to TemplateLoader.Template class.

3.0.0 to 3.1.0
===============================
- Fixed bug in "if" statement scope merging if variable was tested against
  null and then assigned a valid value if so.
- Fixed bug in comparison of primitive values against null. The comparison is
  legal, but sometimes it would cause an internal compiler error.
- Fixed bug in conversion of char properties to Strings. Conversion was
  incomplete and resulted in verify errors.
- Conversion of object numbers to other object numbers was being rejected.
- Added support for exception guardian mode of template compilation.
- Added BeanDoc to the build process for Tea. The Context BeanInfo classes
  are now auto-generated from the source files.  
- Deleted the BeanInfo and FunctionDescription.properties files from the 
  runtime package. They are no longer needed since BeanDoc now generates the 
  BeanInfo files.
- Fixed NullPointerException caused in JavaClassGenerator by certain recursive
  template calls.

2.3.x to 3.0.0
===============================
- First open source version of Tea.
- Packages renamed and re-organized to be based at org.teatrove.tea.
- Templates must be called using the 'call' keyword.
- Some components moved to trove package.

2.3.5 to 2.3.6
===============================
- Fixed replaceFirst and replaceLast functions, which were defective since
  version 2.2.0.

2.3.4 to 2.3.5
===============================
- Fixed stack overflow defect in conversion of NewArrayExpression.
- Fixed ClassInjector defect that caused an infinite loop.

2.3.3 to 2.3.4
===============================
- Fixed a recursion defect in Type equality testing that occurs when an
  object's element type is the same as itself.

2.3.2 to 2.3.3
===============================
- Fixed defect in MergedClass in which the returned constructor has parameters
  which come from a different ClassLoader. This would cause an InternalError
  to be thrown. Class parameters are now reloaded from the correct ClassLoader
  before the class is generated.
- Fixed defect in DefaultContext that would leak memory whenever a date is
  printed for this first time using the default date format. This bug was
  introduced in version 2.3.1.
- MergedClass now accepts optional source class method prefixes in order to
  resolve ambiguities and to allow classes to be specified multiple times.
- Functions can be called with '.' in the name, just like template calls. The
  '.' characters are converted to '$'. With the MergedClass changes, a prefix
  that ends with '$' is ideal.
- Fixed all outstanding type checking defects. With applied changes, Scope and
  TypeChecker classes are a little bit smaller.
- Slight performance enchancement to string concatenation by making a more
  educated guess for StringBuffer initial capacities.
- For string conversion of null, the conversion is applied only if required.
  Otherwise, the value is left as null.
- Equality tests against a string and a non-string will force the non-string
  to be converted to a string unless it is null.
- Added additional method to Substitution so that substitution blocks can
  identify themselves within a template.

2.3.1 to 2.3.2
===============================
- Fixed defect that would prevent Kettle from functioning properly. Kettle
  does not allow use of the WeakHashMap.

2.3.0 to 2.3.1
===============================
- DefaultContext now correctly caches date formats specified with time zones.
- Fixed a bug in converting objects to non-null in if statement scopes.
- Locale can be set in standard context, which is applied to date and number
  formatting.

2.2.x to 2.3.0
===============================
- Values can now be returned from templates. The last output statement in a
  template becomes the return value. Templates are now functions instead of
  just procedures. No special action needs to be taken on the part of the
  template writer in order to support return values. CQ #722.
- If template ends with plain text, then the trailing whitespace is removed
  from it. CQ #713.
- Fixed a bug that would not apply the current null format in string
  concatenations. CQ #425.
- Fixed a bug that would convert null strings to "null" when passed to a called
  template.
- Filled out starwave.classfile package to fully support reading and
  disassembling Java class files.
- MergedClass utility is no longer dependent on WeakHashMap, making it
  usable under VMs that have imported the collections API, but don't support
  WeakHashMap.

2.2.1 to 2.2.2
===============================
- Fixed bug in encoding of large string literals that would cause a UTF
  data format exception to be thrown.

2.2.0 to 2.2.1
===============================
- TemplateLoader is simplified so that base ClassLoader has more control over
  where templates are loaded from.
- ClassInjector and FileCompiler support multiple source directories.
- Created new utility component, MergedClass, which makes it easier to merge
  multiple Tea runtime context instances into one.

2.1.x to 2.2.0
===============================
- Now builds using JDK1.2.
- Removed all deprecated API.
- Repackaged starwave.tea.classfile to starwave.classfile.
- JDK1.2 Collection API supported by foreach statement. Reverse looping only
  supported for collections that implement the List interface.
- Supports relational tests against classes that implement the JDK1.2 
  Comparable interface.
- Better support for handling types defined by interfaces.
- Overloaded replace function to also operate on a mapping of pattern
  replacement pairs.
- Standard template context class is now broken up into multiple interfaces and
  classes.
- FileCompiler has command-line interface.

2.1.14 to 2.1.15
===============================
- Fixed bug in ClassInjector that would cause template to sometimes not
  completely load.

2.1.13 to 2.1.14
===============================
- Overloaded dateFormat function to accept a time zone code, just like in
  Tea/2.2.x.

2.1.12 to 2.1.13
===============================
- Fixed a bug that would cause an internal compiler error when one template
  calls a template that had errors in its parameter declarations.

2.1.11 to 2.1.12
===============================
- Fixed yet another verification bug. This one had to do with variable
  references deeply nested inside substitution blocks.

2.1.10 to 2.1.11
===============================
- Added tons of new string manipulation functions to standard context, and
  added more versions of replace function. New and existing string handling
  functions are more robust with respect to handling null.
    toLowerCase(str)
    toUpperCase(str)
  * trim(str)
  * trimLeading(str)
  * trimTrailing(str)
  * startsWith(str, prefix)
  * endsWith(str, suffix)
    substring(str, fromIndex)
    substring(str, fromIndex, toIndex)
  * find(source, pattern)
  * find(source, pattern, fromIndex)
  * find(source, pattern, fromIndex, toIndex)
  * findFirst(source, pattern)
  * findFirst(source, pattern, fromIndex)
  * findLast(source, pattern)
  * findLast(source, pattern, toIndex)
    replace(source, pattern, replacement)
  * replace(source, pattern, replacement, fromIndex)
  * replace(source, pattern, replacement, fromIndex, toIndex)
  * replaceFirst(source, pattern, replacement)
  * replaceFirst(source, pattern, replacement, fromIndex)
  * replaceLast(source, pattern, replacement)
  * replaceLast(source, pattern, replacement, toIndex)
- Fixed bug that would cause a NullPointerException if left side of string
  concatenation evaluates to null.

2.1.9 to 2.1.10
===============================
- Additional method is created in generated class files:
  static String[] getTemplateParameterNames() returns the names of all the
  parameters passed to the execute method.
- Added replace function to the default runtime context.
- Added support for new language feature, the "isa" operator.
- Fixed array class loading bug.
- Re-wrote code that manages scopes in order to solve several outstanding
  class verification errors.
- Compiling large sets of templates would sometimes cause the VM to run out of
  memory. Compiler now frees up template parsetrees when no longer needed.

2.1.8 to 2.1.9
===============================
- Templates can now accept arrays as passed in parameters.

2.1.7 to 2.1.8
===============================
- Call cycle is now allowed. (you were right, Mark, they should be allowed)

2.1.6 to 2.1.7
===============================
- Fixed bug in string concatenation against an array access. The result was
  being casted to a string instead of being converted.

2.1.5 to 2.1.6
===============================
- Still more fixes for bug introduced in 2.1.3 with respect to parameters. This
  time, a method that accepts a "this" reference as the first parameter didn't
  get its other parameters incremented to the next slot. A typical case of
  a bug that was hidden because it depends on another bug.
- Relational expressions against boolean literals (i.e. a == true) are now
  correctly optimized.

2.1.4 to 2.1.5
===============================
- Parsetree walker wasn't visiting the second, optional range expression of 
  the foreach statement. This prevented Kettle's statement completion
  feature from working while typing the second range expression.
- More fixes for bug introduced in 2.1.3 with respect to parameters. Version
  2.1.4 didn't completely fix it. Parameter local variable slot numbers were 
  being re-assigned under certain conditions.

2.1.3 to 2.1.4
===============================
- Added readme.txt.
- Fixed bug introduced in 2.1.3 that produced invalid classfiles when number
  of passed in parameters is greater than the number of local variables used.
- Fixed bug introduced in 2.1.3 that caused arrays of arrays to be generated
  as multi-dimensional arrays.
- Fixed bug that prevented certain types (like java.util.Date) from converting
  to strings automatically when passed to functions that accept a string
  parameter.
- Code generation can be disabled from compiler. (Kettle requires this)
- Cleaned up TypeDescriptor class so that array types can be unambiguously
  described. (Related to array of arrays bug that was fixed)
- Unhandled exceptions in compiler are now sent to unhandledException in
  ThreadGroup instead of calling printStackTrace directly.
- Passing null to nullFormat function defaults to "null".

2.1.0 to 2.1.3
===============================
- Tea changes from version 2.1.0 to 2.1.3 are not documented.

2.0.0 to 2.1.0
===============================
- Added support for looping through ranges via the foreach statement.
- Other changes not documented.

2.0.0
===============================
- The first version of Tea is 2.0.0.
